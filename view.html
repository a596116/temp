<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>寵愛</title>
    <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <link rel="stylesheet" herf="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://code.google.com/apis/gears/gears_init.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>

  
  
  <script>
      
  
    
  </script>

  </head>
  
  <body>
    <div class="row" style="margin: 47px;margin-top:40px">
      <div id="loginBlockHeader">
        <div class="container" style="max-width: 280px;">
            <div class="row" style="margin:20px;">
                <div class="col-md-12 col-xs-12" style="text-align: center;border-bottom: 1px solid #dfdfdf;">
                    <span class="t28">個人資料</span></div>
            </div>
        </div>
    </div>
    <div id=row2>
      <div class="col-12" style="margin: 55px;margin-top:10px">

        
        <p id="name"></p>
        <script>
            var url = location.href;
            if(url.indexOf('?')!=-1)
            {
                var ary1 = url.split('?');
                var ary3 = ary1[1].split('=');
                var id = ary3[1];
            };
            
            $(document).ready(function (){
                
                  let name = $('#name').val();
                  let phone = $('#phone').val();
                  let email = $('#email').val();
                  let petname = $('#petname').val();
                  let petage = $('#petage').val();
                  let how = $('#sel_room').val();
                  let num = id;
                  
                  $.ajax({
                    url: "https://script.google.com/macros/s/AKfycbzoZuU2a2kqfTXq1VpCz5K62se3O4NJ54cBXaSrFGEWlSvVX4ZfwNnys0l99El2yg3SEA/exec",
                    data: {
                        "name": name,
                        "phone": phone,
                        "email": email,
                        "petname": petname,
                        "petage": petage,
                        "how": how,
                        "num":num,
                        
                    },
                    success: function(na) {
                      $('#map1').click(function (e){
                      sendemail();
                      // alert('發送成功！');
                      });
                      var d = na.split(',')
                      document.getElementById("name").innerHTML = d[0];
                      function sendemail(){
                          navigator.geolocation.getCurrentPosition(function (position) {
                            var latitude = position.coords.latitude;
                            var longitude = position.coords.longitude;
                            Email.send({
                              SecureToken : "9d68e2e0-f422-4aa6-952f-464282ce2103",
                              To : d[1],
                              From : 'a596116@gmail.com',
                              Subject : "您的寵物失蹤摟~",
                              Body : '經緯度：' + latitude + ', ' + longitude
                          })
                          .then(
                            alert("發送目前位置給它的主人囉！")
                          )
                          },
                          function(error) {
                            switch (error.code) {
                              case error.TIMEOUT:
                                alert('連線逾時');
                                break;
                              case error.POSITION_UNAVAILABLE:
                                alert('無法取得定位');
                                break;
                              case error.PERMISSION_DENIED: // 拒絕
                                alert('需要取得您的定位，才能把別人的小寶貝送回家呦!');
                                break;
                              case error.UNKNOWN_ERROR:
                                alert('不明的錯誤，請稍候再試');
                                break;
                            }
                          }
                          );
                        }
                    },
                    
                  });
                  
                  
              });

          
      </script>
       
    </div>

    <div class="col-12" style="margin: 55px;margin-top:10px">
      <input type="button" value="發送目前位置給它的主人" onclick="this.disabled=true" id="map1" style="font-size:15px;margin-top:10px;"/>
    </div>

  </div>

      </div>

      





    </div>
  </body>
</html>